import time


class Solution:
    def uniqueLetterString(self, S: str) -> int:
        width = len(S)
        total = 0
        left_idx = {}
        right_idx = {}
        mid_idx = {}
        for idx, char in enumerate(S):
            left_idx[char] = mid_idx.get(char, None)
            mid_idx[char] = right_idx.get(char, None)
            right_idx[char] = idx

            total += (idx + 1) * (width - idx)
            # try to remove mid_idx element
            if mid_idx.get(char, None) is not None:
                total -= (mid_idx[char] + 1) * (width - right_idx[char])
                if left_idx.get(char, None) is not None:
                    total -= (left_idx[char] + 1) * (right_idx[char] - mid_idx[char])

        for char in right_idx:
            if mid_idx[char] is not None:
                total -= (mid_idx[char] + 1) * (width - right_idx[char])
        return total


if __name__ == "__main__":
    # print(Solution().uniqueLetterString("ABC"))
    # ss = "KJZVYTGPKOWTQZLKLLAWNITVXKGDBUYARETPMOEIAGKPNSQMHQDKNZGBBRELURNPYRPKUCLTFJKDUQYKDJQLWOOVYFIPZRKMAVTEAUDBZIGVVOJHKDEOLWSTTYOIGTZBKRMATFYBVGNIPTZXZGOMVEKMGGOJXORIWQBATYRGESPZAPKJEZGVYVHIDALLMMMVJPNDVAXIBPWVBBAZKLNZDPKCPRISRMEAWUIEOUXAIRQYPRVBXXPUVKZLRSNTRQOBBPUQEUJANLRDOGKVRLQGEXGKUHZXRWBNZGAJVZBZAKQOGWKJGTVUQRSWBYKJQUOXFYKAMQNAGZOQSCRBWGMNPNTJNNTQNWKZKGTKKEARCHZZWTXOPPKYRINUGSWZAXXNXSAYUFUUMQYKLQYFDMPOMQEWERYXVNZDTFWGAWKULGHJRKZERDMHCIKEHXSEGQGKSVCRUJHXWHGSEGTKNJTZJGQFVHTGRIBFDQAJHWYQNWCMIHQNZUPEQQHYTPUFOMIWWUWTMHSPIOEYHBCYHPLWTXQXCIPIPMSTPUZSMBJWEMOXXQLQSSWSRZEUDAPDFWKUONRGHZMRKCQDHWPHTLXXHZWNIXXHBZAXTPPCLRZBSJWLJTRRWMOQHKNTGINFINGRNVKAOKWPUFZMPHLKBYEDEFJYRQRJSJRKBMZZUVQGUUGPFGRJPJWAJNRBMYQERDACHFDSLHRIXDFPPMZHZDPUSSWTNJCMOFIYXYOVYMDCEEQKEZDXEUSCWIDTHKXSPPKDPXPNCVRVJRRAQOMXTGYVIPDAOSWCLXASFAQEUIIBAXDCGYPHHFPGWVTBMJAOCOCMUFZGKQPJGHAEKUPCRSSBQVUKVOVZFSJFKSROBMYKTITGFLPFKZRJBRIEFEVRUUWGBUINFYAUJAGPXMDULEGLKGXWNAFXVSCZUCANIIBLIJLHQXYFVBLMCEXKPAFHJPFFDDWCBIYWLHVQVUHUMUSARBVTGVFXEXCMURWMNNNFKDMFSALQMALIFOJMJKERPJFVCNOEBTUQZNFIYDMXPYUWLFBSHLIMKGLQMMNXVAYCJRPUJMCGJBLAGSRQEDJWQAFSTTKIWJQKVQYLDZTOECUUPIDPZBNMWJKYDSYBSBVSGPJMWFTSGMHQTXVCVAGOJJZARYRCEEPNIOLTGMHXZGGRSXWULQYSEZVLIDFVUMWNGNYDGBBBHYQTEYJECAQMWMGQQCUUYGJGYLLSPBUUAZMTFGHNBOSZAARAWKZCWHYYMRBLQUSEANCJVAWKZXHBDDVVWWMZSYIXKINRNIQNKIPADGPMZLOUHAKJPFLKYUQDCRHSDQBWTJYRESSWQJYVRYUUPBBMIGOKQMGRHVSWXYKJMWWGUHSFOWOZLRNIBIDVIUVVVMHTJEAXOQISNNHWYGKHCEPBQSMOQXXDUWGDJWMCVZVKSDWMRIQUKJEILXENNYKYXCTLBQNQWDRMPTLNKHFTVWGBONMDJIDQHFZXJQHTAOZUGNCJWBVRPHPFUDUUBAAGFBUXOMEOGPOFOYYRRBGNQMBWKUADXYPMCKQMHVRTMVIFTNYTVWIKYOJQFONXGPVNTTDQDZUBDHPCPMDCVSWSBSDKSUIAYQQTNQEFAOLUFHKGHEXTCHLGXOBLXRDJKDPQDVOZXKKZCWWPRIVMPSIJDDQLSWXDDLXAXZYWLRDUKOCXSAYHBPXWEGNAIJQRWZMWLXCBPNEOTKDIEJCMREJIYPPKIVLYNIGOBVCAYAZNCNUHKAYCUGGSQHVCHMJJGWNEHTUTZHPSJILWINMGJIMKKSITPODIOPOUCIOMSEBWZEDPAONQLPTMNLXGQTOOLLMUGDLWSPRKLGQEDIOKBDDFOMCYSEJFBNCNHJFWAVPVFFBGRQVQWOCVKUQIJOEKWOAILSMHDCNACVZRVFDTBRZYBNJIRHBTXUBOLEZMGOIVSYFCRHEPTVVUQSKTMUYSSQUZUUMBRFCHCYTBLJYAQFLCXKSXATLRLUOMRHLORYGAYRCQCBZGLZVUDGTWIYFDSWSNRODZCMCDVROIJKSKBHUITJMDBLJTLHBPRIPTNQKVDRDIMHSIDXVQODEFGYHWQBCYXKTZGVTOVSIVPEYTZNSBUQHNDEOHOXNXUYUXKTYQVTFMAZRSPDAXGSRSJGTGDJGZRQYUJDMIXSKATOIRZCJYNNMLKLQRQPDDVXZBJPAXTVHYZWZPZXCRYDAERROWFWMKFBFYVAYHJEOIVUYGACHYHXTNXPPAIFPBBCXEWDNZDOGHOITEEHVBZEINQWRWEPHCLUBYSDXOULEAKEMNLFMUKNKDVWOKZPJDSJHYUYMHXRLLXZDUWCVUMZJHTOMNNTTDURFHQOKYKQAFXSLFMAVYYAGMIZDWBCARMGVCRIGILAJLFQGNFPDEPCWQTRGAAXOZEIKWJKULXEWEKDEIBMHKIGBOPWXNQJIMJQLEQFUEEICKQLVTIIAFHIBPQFHAGXLAWXOUQUFTZHWLIVSRXFSFPQLUMIPINQBNDBLMQEOJGIQFWKGVAODPGTHMZBRZYROGQTLJQNVTCNXNTMNBXGQSHLUAEMEATWSGUCRIDNNADNZWGUMUFWRLDQRRHGPJOSHWJNIMAEKBFXTTGCKZPGDJPZKNSMCMRPJXFUUERVICGVDXWRDHMXPXKFXLMBZXVYKZQHJJCBRMHTZOJDKHXBKAQHSMYFUOSFCYFMCIIGJGTHKFLRPRVMRFOZXMDKUBTNDMHZINJCUDCJDGDXAAGRZXKSDCNDCKKAXQWOURPDBXBRKMCCBVFAHVSWLFBZOMFNCMTNDFXREQMWONKEZULSYKXAHUOYYKFSPPBBAUKOBKYVAJMKHQMJTOAIXWPLDOQVLSWHRXAXUWAXLTWRNWEKGPAJFGTYGUZASFWFAUPYGIVWIYJGAUOAPCJXQNJHTOWTEGETYFDZCDIOTJFKFPEYANQEGMEQHBNCCACTYVDLKPZRQUPCQLGRTXDFUSYRMTRNYMYTEPGKKNDCCSOYJOLXPJCWSTKHRYGEUEKUZOTUGZATBAFFYJFRYTKOKRATWBIWXONRUNPBNULCEARCOWGEYTLJVVVVGODFYJQYEYBOAGQWREMOKIBFYTRGICCZACSHJGFDFVBMJMWMMTDJEDCHMAYRAWVNWJPNDGRYXOCOZHLVHBKBGZBTQUFGTOLNOZWDMOSUZUAEFSRYUALXPPBIWRDGWSUWZDAPITDUCRAZFHBNQPXZZIHZFZHLDYDAKRUBDUZOTIAJWHNCBTMRQRVSUZGBHLHGNHXGLKDOYBTCMYZYGCNJKZFRLFDBEWDOOOLDELHQJKYLXLFRNXDMRDKCCDCVNLYNDQYMAPNXIPESSIWFXKATPIOYZLODSCSHHLZKVSRMSPASJDMTKUAJNFNLTWVRSXOHLYQCWPOHZCHQQQJCZNTTKCQEWYXCJFIRECTDVTFYTNCWWNYYFMGWBJVUHXMXXGACUATMUPIWUOHVZOSUNCUGLYBXENTVXEYUPJDXHERSZRXVQZYZIYQENAGLJGIBHCDHFPBKIYPNUPRJHRHXDSSJAKHOZKGIHOQWTCNEEEKPBFOSVNQAVPYJJMGNBJPJOVCYJLWBTDFNIGOHYOGNGTOVXYSHWCBVYIYWPTPQCSSIINPGHPLPUQLBRSNUUKODFIUAXZXMNQGSODGBJKCNHNBBEKBSRZYYBGCHJCRADPRRIUCEGVJTWWJJSDLCPBDMEHBEOQMGQQPEYKTRKJXJJLDBUORRQDRRRCWYCABNJVOQGUSSZZRGBGPYKZHTNFALMTAJXEMMXNZJZDCAZIYRMTARTQHJYRSDWCEUTYLDRGXEXJLHWOCKQPYONYGXIXDARFBKFKMGBFJFUVBCXFSYOYZJWZTBFCUDFCRLQPCUPPSQZXTILCMTXCMMFQPYINFSDHOCFCGKDRBKMCHOFWTLXNVCCGXXJJQNVBMJVFQYKXBNGLOYAEAIBFCQTONKTUQMSVMWSVXBIUJEOPOBYFOZYTFFUISXQHTPYPWILMYVYFNRQLLPXKAKQYPILXDPHRQMDHWAKIZCBHVZWNXPKIRQVZYQDXNUVBTWVXPYHFKIZPAOKJBJUGHPHCCBCYXJYSJPXUNLYZQXKLRCVHAGABLFLIBBHOPNAARQBCSACITMUZTLUDEPGQSTWBMEDPPEGALXBOYWCMASHMWDLWTSWWWUKMRIDVOGPQEMKKMRSGMUAIWLFXXNHCDBPDTVDWGNJTBTQVGJLCHWMIRDGOVNJRRCWKKYURAIIQCMEQICXPQPOBUVEJTTVUKJVJUWMQDWZVHLEJCDMNMROAPHXOFQFNQQWMMDONNOWMLHOZLCZIGNSUPUGQFDEBBAJJEIBFVUAKHZCQBBUUCQCXFGHISLWSUTBEYDLSKDFBIUYDQSBMWTYUGESNMZOBCWBTNNQICEEZBRNMIAJEWCUDFCTWVJVQQMLGSOSPQHQNCDJNNTYNMZNOIHRNVLBZJEMIDLDWJMVWODMANIJSVLECZLGKTBJCNRYSLHYUTRAZYZIHTAGZQXFUCELSXBHSMSSTSRGKNMZKOLMOMHDNDZHZJUAXXTDKNOHHIQADMDECLSKIMIUIQWBLYEGLEIJJLYXUILNJMSGESLEJKKGTATRMXBVWXFSKBWJUQYTMNSNVLWHYKMGLITFXISOWRCNLEKANMANTTPWSELVRTNGANETEPRHKATVWZWXPLBXGDOKZKDJKLGLMVCYOGNLQSLDPJGPDAOZENZJNKZJHNMOJYIYMLSFATGCZNXLZXQOAJXEPCFPYBJNJFVVGNQPPSOVELFCYZLSKVEZFWDMWKOGYJGHLLQVRNCGRCMIISCREWWLUWVTEGUEVAIGJYGYWZOQFXDMSLHPWSUXVWBPOMMKUHSJWPSYZGQJORZODAJJRISTNAFONBNZMXSGWBFPDEISGMHBHUTVJLNOOAPFTENMNIIYXHBAPOMUBYGQAHTFNIQULZHTXJXFVOVWXHLFHCYTCISODGDFIOXPBLGZDIVXIHMTFJOCBNTOKIOJLANPZLLXDMUDQGRQPTEPLJVNYSZKTOEUQFBGXKGULDOHSVXSGHOTXSRFKBPCEHLARXOEBSXYKWLWUGGXOGSXDRSDVRWRNUVFISNNHZJSDORAUURULNTFEYOLIHQYVGWNKEZMMDNARXPERAGTCPRHZRGKUEPENDKDFPRHXDNPAEGSCXNULLAGYVURWTDXEGLHHMGYDSVPIASVPBGFPARCDNTGRQNOKKDEWLLETXRYDOGVJQKNXSMBYRYJICFTJVTHMKBUAEUUGFKHLRVWIACWOLHYOXVZPJWNXBMERTYKSDSKDVUVKDZXSFGEDCWNEIQVXDUCWNKWTDLDEQDCZTBEYQWTIREONEUABKQITXJFREUNBCSQLWLPHZYUKAFITHFBGTXCRFELCPXIZITMHJIDVFPBHZPNHHWLPROPUWJBHDFEEGADLISCXYHUBXQEVEYKMMZFSQJDNMUAIKRDAAJEWFKXNTVZKYSDSEMXQFWQXXSYMLQACZWPIRSWLIOQRBEPKIIBVIJCRFVUQOBAJJRDIBMEPVTEZHCWOQHDPTQULTWJQREMQVIAHVHPRZKZJJRBSYTCQYFCUVZZINOIZOSUGALULOYHAZUDPDJZJWXKRKGTTGOWBXJIHPNRHASHTASLBTUYGNYLRLOXXOYVZYMFWARTTNSDETGYDZFCVOKXKGIZYDBRPZPBEZWSGNMOMJMFCGTFZRIQWCGVHGNQZXVUGVQIOGSQDZPFDDODFGVGLYEJBLLEQBGLIHMCUUVTRWZLQXNOKRKCTBVOQWDYABCEDMMCRPIMBGWOPQLCWKUPKRQLHOGAIBIYKFARNJXGOWIDJFOJGOELJBJGALJJOLHJOYAJDNNUNVXWVIHVFWOBFJUYRZLZMFOILGAXSRTGKNJHKDKYAFRVWRGPZLVKRUTBZOKNRUXSWCAJRGKESJUECFKNYYUXBGPNCFZGMKLIYXRVUMZTRYTTAYQFFLTNQMMRREYDAEERSYQGDKOTKCNYIFHVDRSRRWCTYRLBCBUPUHBDUBFVDQZIQNVRCEZOUOYYZHNFKQWJPPLGSCTRSHAOKQWQIDCKRHMHFZXZYMEYPAVLOSJTKLGGSUXMCECJDDYGONEZQMWBBUDHRFRQRAIPSSQLXFPDEQRYVVYBRBQVQMSAUJBTNXTQSHTOYMZEUEZHRYDZWATDVXGAZAROGICLZXOEXOVRKMASOMZDPAKTAALGKCANNKCNJTSEIQMRMWVCMFPZSAWPZIHOCUYJDXWPNJVSJNQYHTPDYSHUHUQANSWQVQTZAJFVUDSVIMXFYZHTBIIYYSXFWGHJLOMCKHEIOWFTUUVGCJEZMKTVDLMOWMUHZAKWWKFCAGXMRSGEAEEZMPQKREXBVDZQXTXWMDCFQRWFZZVWXDMNREQTVTUWGQHNJIGUUAEQSLXMTUUJVQKHADYGMAVSQGWOUYGJDIDQTZVNGPYSHSLXPBWXDCPMILVQSIJNUCJWDPMHGAPISQDGJQWATMPLRIMFECIAYPZYHBZBODOXIUFTPFXHBAUVKJUQSUHTUTGSGVMVYLZQWBYHRVSVAIHTKNGWVSGZGMZCSZWZOSPADPERJVFMPAGRUBCNMGYJGJPYRHWZLORXFPHNEVYIYCMXDHWSPHNMSECSAEMPQBJVWOZIEESRVQJDJCHUKQXDZPWSSPLXVOUBCJJNETLNJBLKBSEHESKKAARZSUQDFYMFFRHUAAGBIUXOLQIDAAJJEUCZLGGGJUNMRPWLRUTPOQAXOYNSFTAAMYYNJNZIAYRQYPAMDJGXPLUWBUZOGNWKYQHGFBTJOTUMSHJCUGZOETKOPEHGSZHCKKJYJNFKKABODOWNAWDSQVWQUHGWIKROJNZUXRHUZUJSJTPGFGQUDYBXFXTOQNPTCPPJODVVFCLFOAXBKJCMMQZFVBARYEZNUSRFNWQMSOEWJAUIDBFHGBHPPCATPVUHVUREMMKNJVUDLUYTKFBUHUORYWURRCUBNURDESBTXIMJNSNZVAOHWNBQZUROVRVIXSEFEATFSDYHVZUPQSETAOMTHQVYEFDRWSLJHAREIUPEQKJKJQEJLDHZKCMRFVNVAFXDVRXZBFVJJREMEVVDJVOWHGMIUSVSCTQOCVCWWKGVLXHBBUBBHRBVBEYYDTOCHQEDKMUBWTWZGNQXZYNCSHGVZOXZGXXUYOPLGUYCOIKRPPPBAQWOAIRERJFKVNHGTDAWGPUCLSZUYSGVFZOGPYNFDVXOVTJLFZBMZOIPWTLMZMVLUBRKCJUOPNUIZWDFGBEKKUYFZYBXJTLTPKBKRSAASMOKXTYTLFWLVQZZZJYWLCCKXSPQVRILPPBPSJKEPPHXAGBQESHEHBARMBFIQNWZCLLBMYUDNZOGBOYEQGYVNGICQCUCORMKYDPPHKRQXDSWHFBKEHUKXTYJKXXSFTOXIFJCSMCFPLYINSXHLRHFAVAMFUKDNOYQMESTZSGXRESRBUJXBESVNGUNQHHAZUAMRDXTNLLTEUBUSPINULLEDCFKHOWMQIYIGXBXDEPBECSNILNMKPNZJIKUXYKTYEJOKRVULDNLGXFRBWTDMMFSUHOXIODDMRUDIZRKPTHQOHQHHACRQXLABFEVYCZVXIQQFRSQQXMUNKPDMNYKGXDKHOVFULQYETZUFKHVQQZKUDESBUMEWJTFQOMWDAZJINOUEZMHPQVMGYNCJDXCNUGBRGGYZVIBYQYBVFDXZAGDNCVANGLQOKBCYNKKPHYIBIGVYUMOYULQNMXOVXHGZZBOKDKSSRNXINKAOBPHKKRWREMMJEBKPQOKUJEQTRVMNRIRGEWCCNTESBBQDSYSVNOUKFUVOBOKJBRUAUANYBKFZGWFKVUTIYHCJQYPLMIVIIHRSRKNDFXGGHNEJENUUWNEFUOXPLSCQDODCIKFEYWQXPIGLWVRMTWTNYTLDTIWWTHGOMZZOWTCZJLFWNDEAVTMHCWOHLWBQYQCFSGKCKVUDMXLBAOGZRETGFEMOSDZIVYBDYVFVMBRHZPTCXLQEYKHIFRIEADJDYKSFNGIHJDNNSZTTQACTVKCBZROCHKSRMQUPWWDVGLTTZGSPTUIRUXSIUVISZUIUVXVEZYZCFWONKEYVMSFVMTNDEYVDSHZVZDRUFASHZVQABSBAZEUFGGBJTEXUQQFQEWDJEZIJDSLQBCACSNCKIAUAUJEVCVHHKWVGKVFYNWWBIUDOAILZVFLTGRJZPFMTWZVJFYYXJHCOJXAFOIYRVSAJQWVUUZWHWEKNMCCEDYMYFPROFNESDYIVZLKQAWBYKDVZFUVEBGWHBEHNVECKXOBMELQYBCQHFGNIISVEGGHAFITUHBRPYVSPSPPVIILVWIUUTQRUGZBMPJLYYZPUIVDIEEKICFJLZHOMVKIFJCOYKWQJGOHPVJEAODUFTNBNHBYYPRYQGOQWGBAFOXDZHBPBOMCVTBTBGDOFDVTDQFFAWRZAXZMRZNSYBMLAHRZACJXCUGOYVIDKLFOMPQSPRXAWKDOLMLTZTDNJMJKABXSULDRHLZMGBYMDNMNJMLDLDRLISLAXYMPOYXIWYYDDWQGETVSQIYQWMHAOJDXXMKCAFVDHUKAWFNXHHYZYBEEGPEVRHTNGFGUTJTHHTDNULZTFXBNRNYVICHURRRQNZQNQPLQEFHTXFZYCOEZUIRQPJLNGOGKFOWLAWHRAFEIBKPVOAODLPYAXDHKIKXBIPEHALJGENQYXZVHSZGGGCUKMMZKRVSTDRJZYUCFBJMZYJEFDJJAUSJZHTAKTQPOPXIFCOBLQHKOQCFFOXORXATWGEXICPUVGDSKEGNPWTMSCVOYIJQRHIOBHBKCUFZDGHRKXAHLEZWOYDMXZALWRUVJJAFKPNSDSRWAWBSUXQEUMAKMUZXHCRUJSPPHGRHDPKENFQZLQETMLAYZUAQPUWCBTQNDMSNCUXPRAFXZHRCJUWSMIRXIRFKWECNKGGSKOTATTYDTQPZUQLVEVPMEHKIBAIYCTBNIZUVRUMLGXVENUHJDUBHZDYXJFUZWEEOGDFDGUEVOTBMNLSTBIJQICEOVRKDUFLRHDMRHPYWZNYVDNCZPENXCNVDQXVWVYQIKAYGRWHUJMFQOTOJKSIZJRUATJIBZJSJCTMSEXVLBYSTSCAIBLSGOKJRDLCZJWIKNSHCIXPXXQDQHEEKVCKTAUGGGFYACKGOQBYHDKKPMBQTHVLDOOFMFEOIOPCKPTBCKIOZUCFYXHISVIJVYZLMQUGGSCXWOJYCICSYHORZPFUPRUOBCXTVGAGTCYVVNBZNRAGQQDUVQLNBONIHVLZOWYTOPSOCYNWBYVIRHLSJGVHQQTUPLOKBUJKANKIZJUQXFCNQTUEXVOZNQSLXNDJTMZCYEQWJMUYLFCIKGYTHOCBXFYKGSZODFWLRKCJICLEJKMWXTEZVRTFGGQJRCHDIAASUKCGCMRQKIWOEHVZSFXMJSHWUWHGIKMTBMORGMBKZAKVYDFXRGHINFVRMBQVKMEJPOVEFSDRKIHENVMZWSEENBKZMYALZPXRUXKHJQQCBONPKZFCUWQRPPLBWPGQZSPDVTBNMSVQENCSKNSGIUGPWYZWMUJBNEJCAUECNBVNVOMRALUKYWYJZWGIFGQHAZGJRFTAXDZZDTEFXVBDVMYCUTVSPHHYAMTVLCZHGPRHNRRFFRWZYIUDWWVSQKPJHICMYNBJDTKPWDVEYHLSBYQRAKAKITOOMLGFOJFSTWOBPMTUTMMMAINORPXWGZOUPRTAXJISZVIOJAQTVXNLMKPBMEOIDQFQFZZCAUIDWNIWAFZWZWADFGVUTPRYLVFAGSZTTJJTEYJRFXHQJNEQWQIWMVOZYVSHASONSOQSEZEZJYIYQBVUNJQVAWNSWNLOVVPFVOGUMEJPOLCHZLEECOSXDRWWARBOWRRXSJORRACKWJSXNVORNUMEECHKUSKUIZEGNFRHUVVFEEMKHHYSHHTPPBIXOASCMBXVTRH"
    # ss = "KKJZVYTGPKOWTQZLKLLAWNITVXKJZVYTGPKOWTQZLKLLAWNITVXK"
    ss = "ABA"
    # ss = "AAA"
    start_time = time.time()
    print(Solution().uniqueLetterString(ss))
    end_time = time.time()
    print("time:", end_time - start_time)
