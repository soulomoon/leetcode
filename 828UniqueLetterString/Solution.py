import time


class Solution:
    def uniqueLetterString(self, S: str) -> int:
        width = len(S)
        subs = 0
        left_idx = {}
        right_idx = {}
        mid_idx = {}
        for idx, char in enumerate(S):
            left_idx.setdefault(char, None)
            mid_idx.setdefault(char, None)
            right_idx.setdefault(char, None)
            left_idx[char] = mid_idx[char]
            mid_idx[char] = right_idx[char]
            right_idx[char] = idx

            # try to remove mid_idx element
            if mid_idx[char] is not None:
                subs += (mid_idx[char] + 1) * (width - right_idx[char])
                if left_idx[char] is not None:
                    subs += (left_idx[char] + 1) * (right_idx[char] - mid_idx[char])

        for char in right_idx:
            if mid_idx[char] is not None:
                subs += (mid_idx[char] + 1) * (width - right_idx[char])
        total = 0
        for i in range(width):
            total += (i + 1) * (width - i)
        return total - subs


if __name__ == "__main__":
    # print(Solution().uniqueLetterString("ABC"))
    # ss = "KJZVYTGPKOWTQZLKLLAWNITVXKGDBUYARETPMOEIAGKPNSQMHQDKNZGBBRELURNPYRPKUCLTFJKDUQYKDJQLWOOVYFIPZRKMAVTEAUDBZIGVVOJHKDEOLWSTTYOIGTZBKRMATFYBVGNIPTZXZGOMVEKMGGOJXORIWQBATYRGESPZAPKJEZGVYVHIDALLMMMVJPNDVAXIBPWVBBAZKLNZDPKCPRISRMEAWUIEOUXAIRQYPRVBXXPUVKZLRSNTRQOBBPUQEUJANLRDOGKVRLQGEXGKUHZXRWBNZGAJVZBZAKQOGWKJGTVUQRSWBYKJQUOXFYKAMQNAGZOQSCRBWGMNPNTJNNTQNWKZKGTKKEARCHZZWTXOPPKYRINUGSWZAXXNXSAYUFUUMQYKLQYFDMPOMQEWERYXVNZDTFWGAWKULGHJRKZERDMHCIKEHXSEGQGKSVCRUJHXWHGSEGTKNJTZJGQFVHTGRIBFDQAJHWYQNWCMIHQNZUPEQQHYTPUFOMIWWUWTMHSPIOEYHBCYHPLWTXQXCIPIPMSTPUZSMBJWEMOXXQLQSSWSRZEUDAPDFWKUONRGHZMRKCQDHWPHTLXXHZWNIXXHBZAXTPPCLRZBSJWLJTRRWMOQHKNTGINFINGRNVKAOKWPUFZMPHLKBYEDEFJYRQRJSJRKBMZZUVQGUUGPFGRJPJWAJNRBMYQERDACHFDSLHRIXDFPPMZHZDPUSSWTNJCMOFIYXYOVYMDCEEQKEZDXEUSCWIDTHKXSPPKDPXPNCVRVJRRAQOMXTGYVIPDAOSWCLXASFAQEUIIBAXDCGYPHHFPGWVTBMJAOCOCMUFZGKQPJGHAEKUPCRSSBQVUKVOVZFSJFKSROBMYKTITGFLPFKZRJBRIEFEVRUUWGBUINFYAUJAGPXMDULEGLKGXWNAFXVSCZUCANIIBLIJLHQXYFVBLMCEXKPAFHJPFFDDWCBIYWLHVQVUHUMUSARBVTGVFXEXCMURWMNNNFKDMFSALQMALIFOJMJKERPJFVCNOEBTUQZNFIYDMXPYUWLFBSHLIMKGLQMMNXVAYCJRPUJMCGJBLAGSRQEDJWQAFSTTKIWJQKVQYLDZTOECUUPIDPZBNMWJKYDSYBSBVSGPJMWFTSGMHQTXVCVAGOJJZARYRCEEPNIOLTGMHXZGGRSXWULQYSEZVLIDFVUMWNGNYDGBBBHYQTEYJECAQMWMGQQCUUYGJGYLLSPBUUAZMTFGHNBOSZAARAWKZCWHYYMRBLQUSEANCJVAWKZXHBDDVVWWMZSYIXKINRNIQNKIPADGPMZLOUHAKJPFLKYUQDCRHSDQBWTJYRESSWQJYVRYUUPBBMIGOKQMGRHVSWXYKJMWWGUHSFOWOZLRNIBIDVIUVVVMHTJEAXOQISNNHWYGKHCEPBQSMOQXXDUWGDJWMCVZVKSDWMRIQUKJEILXENNYKYXCTLBQNQWDRMPTLNKHFTVWGBONMDJIDQHFZXJQHTAOZUGNCJWBVRPHPFUDUUBAAGFBUXOMEOGPOFOYYRRBGNQMBWKUADXYPMCKQMHVRTMVIFTNYTVWIKYOJQFONXGPVNTTDQDZUBDHPCPMDCVSWSBSDKSUIAYQQTNQEFAOLUFHKGHEXTCHLGXOBLXRDJKDPQDVOZXKKZCWWPRIVMPSIJDDQLSWXDDLXAXZYWLRDUKOCXSAYHBPXWEGNAIJQRWZMWLXCBPNEOTKDIEJCMREJIYPPKIVLYNIGOBVCAYAZNCNUHKAYCUGGSQHVCHMJJGWNEHTUTZHPSJILWINMGJIMKKSITPODIOPOUCIOMSEBWZEDPAONQLPTMNLXGQTOOLLMUGDLWSPRKLGQEDIOKBDDFOMCYSEJFBNCNHJFWAVPVFFBGRQVQWOCVKUQIJOEKWOAILSMHDCNACVZRVFDTBRZYBNJIRHBTXUBOLEZMGOIVSYFCRHEPTVVUQSKTMUYSSQUZUUMBRFCHCYTBLJYAQFLCXKSXATLRLUOMRHLORYGAYRCQCBZGLZVUDGTWIYFDSWSNRODZCMCDVROIJKSKBHUITJMDBLJTLHBPRIPTNQKVDRDIMHSIDXVQODEFGYHWQBCYXKTZGVTOVSIVPEYTZNSBUQHNDEOHOXNXUYUXKTYQVTFMAZRSPDAXGSRSJGTGDJGZRQYUJDMIXSKATOIRZCJYNNMLKLQRQPDDVXZBJPAXTVHYZWZPZXCRYDAERROWFWMKFBFYVAYHJEOIVUYGACHYHXTNXPPAIFPBBCXEWDNZDOGHOITEEHVBZEINQWRWEPHCLUBYSDXOULEAKEMNLFMUKNKDVWOKZPJDSJHYUYMHXRLLXZDUWCVUMZJHTOMNNTTDURFHQOKYKQAFXSLFMAVYYAGMIZDWBCARMGVCRIGILAJLFQGNFPDEPCWQTRGAAXOZEIKWJKULXEWEKDEIBMHKIGBOPWXNQJIMJQLEQFUEEICKQLVTIIAFHIBPQFHAGXLAWXOUQUFTZHWLIVSRXFSFPQLUMIPINQBNDBLMQEOJGIQFWKGVAODPGTHMZBRZYROGQTLJQNVTCNXNTMNBXGQSHLUAEMEATWSGUCRIDNNADNZWGUMUFWRLDQRRHGPJOSHWJNIMAEKBFXTTGCKZPGDJPZKNSMCMRPJXFUUERVICGVDXWRDHMXPXKFXLMBZXVYKZQHJJCBRMHTZOJDKHXBKAQHSMYFUOSFCYFMCIIGJGTHKFLRPRVMRFOZXMDKUBTNDMHZINJCUDCJDGDXAAGRZXKSDCNDCKKAXQWOURPDBXBRKMCCBVFAHVSWLFBZOMFNCMTNDFXREQMWONKEZULSYKXAHUOYYKFSPPBBAUKOBKYVAJMKHQMJTOAIXWPLDOQVLSWHRXAXUWAXLTWRNWEKGPAJFGTYGUZASFWFAUPYGIVWIYJGAUOAPCJXQNJHTOWTEGETYFDZCDIOTJFKFPEYANQEGMEQHBNCCACTYVDLKPZRQUPCQLGRTXDFUSYRMTRNYMYTEPGKKNDCCSOYJOLXPJCWSTKHRYGEUEKUZOTUGZATBAFFYJFRYTKOKRATWBIWXONRUNPBNULCEARCOWGEYTLJVVVVGODFYJQYEYBOAGQWREMOKIBFYTRGICCZACSHJGFDFVBMJMWMMTDJEDCHMAYRAWVNWJPNDGRYXOCOZHLVHBKBGZBTQUFGTOLNOZWDMOSUZUAEFSRYUALXPPBIWRDGWSUWZDAPITDUCRAZFHBNQPXZZIHZFZHLDYDAKRUBDUZOTIAJWHNCBTMRQRVSUZGBHLHGNHXGLKDOYBTCMYZYGCNJKZFRLFDBEWDOOOLDELHQJKYLXLFRNXDMRDKCCDCVNLYNDQYMAPNXIPESSIWFXKATPIOYZLODSCSHHLZKVSRMSPASJDMTKUAJNFNLTWVRSXOHLYQCWPOHZCHQQQJCZNTTKCQEWYXCJFIRECTDVTFYTNCWWNYYFMGWBJVUHXMXXGACUATMUPIWUOHVZOSUNCUGLYBXENTVXEYUPJDXHERSZRXVQZYZIYQENAGLJGIBHCDHFPBKIYPNUPRJHRHXDSSJAKHOZKGIHOQWTCNEEEKPBFOSVNQAVPYJJMGNBJPJOVCYJLWBTDFNIGOHYOGNGTOVXYSHWCBVYIYWPTPQCSSIINPGHPLPUQLBRSNUUKODFIUAXZXMNQGSODGBJKCNHNBBEKBSRZYYBGCHJCRADPRRIUCEGVJTWWJJSDLCPBDMEHBEOQMGQQPEYKTRKJXJJLDBUORRQDRRRCWYCABNJVOQGUSSZZRGBGPYKZHTNFALMTAJXEMMXNZJZDCAZIYRMTARTQHJYRSDWCEUTYLDRGXEXJLHWOCKQPYONYGXIXDARFBKFKMGBFJFUVBCXFSYOYZJWZTBFCUDFCRLQPCUPPSQZXTILCMTXCMMFQPYINFSDHOCFCGKDRBKMCHOFWTLXNVCCGXXJJQNVBMJVFQYKXBNGLOYAEAIBFCQTONKTUQMSVMWSVXBIUJEOPOBYFOZYTFFUISXQHTPYPWILMYVYFNRQLLPXKAKQYPILXDPHRQMDHWAKIZCBHVZWNXPKIRQVZYQDXNUVBTWVXPYHFKIZPAOKJBJUGHPHCCBCYXJYSJPXUNLYZQXKLRCVHAGABLFLIBBHOPNAARQBCSACITMUZTLUDEPGQSTWBMEDPPEGALXBOYWCMASHMWDLWTSWWWUKMRIDVOGPQEMKKMRSGMUAIWLFXXNHCDBPDTVDWGNJTBTQVGJLCHWMIRDGOVNJRRCWKKYURAIIQCMEQICXPQPOBUVEJTTVUKJVJUWMQDWZVHLEJCDMNMROAPHXOFQFNQQWMMDONNOWMLHOZLCZIGNSUPUGQFDEBBAJJEIBFVUAKHZCQBBUUCQCXFGHISLWSUTBEYDLSKDFBIUYDQSBMWTYUGESNMZOBCWBTNNQICEEZBRNMIAJEWCUDFCTWVJVQQMLGSOSPQHQNCDJNNTYNMZNOIHRNVLBZJEMIDLDWJMVWODMANIJSVLECZLGKTBJCNRYSLHYUTRAZYZIHTAGZQXFUCELSXBHSMSSTSRGKNMZKOLMOMHDNDZHZJUAXXTDKNOHHIQADMDECLSKIMIUIQWBLYEGLEIJJLYXUILNJMSGESLEJKKGTATRMXBVWXFSKBWJUQYTMNSNVLWHYKMGLITFXISOWRCNLEKANMANTTPWSELVRTNGANETEPRHKATVWZWXPLBXGDOKZKDJKLGLMVCYOGNLQSLDPJGPDAOZENZJNKZJHNMOJYIYMLSFATGCZNXLZXQOAJXEPCFPYBJNJFVVGNQPPSOVELFCYZLSKVEZFWDMWKOGYJGHLLQVRNCGRCMIISCREWWLUWVTEGUEVAIGJYGYWZOQFXDMSLHPWSUXVWBPOMMKUHSJWPSYZGQJORZODAJJRISTNAFONBNZMXSGWBFPDEISGMHBHUTVJLNOOAPFTENMNIIYXHBAPOMUBYGQAHTFNIQULZHTXJXFVOVWXHLFHCYTCISODGDFIOXPBLGZDIVXIHMTFJOCBNTOKIOJLANPZLLXDMUDQGRQPTEPLJVNYSZKTOEUQFBGXKGULDOHSVXSGHOTXSRFKBPCEHLARXOEBSXYKWLWUGGXOGSXDRSDVRWRNUVFISNNHZJSDORAUURULNTFEYOLIHQYVGWNKEZMMDNARXPERAGTCPRHZRGKUEPENDKDFPRHXDNPAEGSCXNULLAGYVURWTDXEGLHHMGYDSVPIASVPBGFPARCDNTGRQNOKKDEWLLETXRYDOGVJQKNXSMBYRYJICFTJVTHMKBUAEUUGFKHLRVWIACWOLHYOXVZPJWNXBMERTYKSDSKDVUVKDZXSFGEDCWNEIQVXDUCWNKWTDLDEQDCZTBEYQWTIREONEUABKQITXJFREUNBCSQLWLPHZYUKAFITHFBGTXCRFELCPXIZITMHJIDVFPBHZPNHHWLPROPUWJBHDFEEGADLISCXYHUBXQEVEYKMMZFSQJDNMUAIKRDAAJEWFKXNTVZKYSDSEMXQFWQXXSYMLQACZWPIRSWLIOQRBEPKIIBVIJCRFVUQOBAJJRDIBMEPVTEZHCWOQHDPTQULTWJQREMQVIAHVHPRZKZJJRBSYTCQYFCUVZZINOIZOSUGALULOYHAZUDPDJZJWXKRKGTTGOWBXJIHPNRHASHTASLBTUYGNYLRLOXXOYVZYMFWARTTNSDETGYDZFCVOKXKGIZYDBRPZPBEZWSGNMOMJMFCGTFZRIQWCGVHGNQZXVUGVQIOGSQDZPFDDODFGVGLYEJBLLEQBGLIHMCUUVTRWZLQXNOKRKCTBVOQWDYABCEDMMCRPIMBGWOPQLCWKUPKRQLHOGAIBIYKFARNJXGOWIDJFOJGOELJBJGALJJOLHJOYAJDNNUNVXWVIHVFWOBFJUYRZLZMFOILGAXSRTGKNJHKDKYAFRVWRGPZLVKRUTBZOKNRUXSWCAJRGKESJUECFKNYYUXBGPNCFZGMKLIYXRVUMZTRYTTAYQFFLTNQMMRREYDAEERSYQGDKOTKCNYIFHVDRSRRWCTYRLBCBUPUHBDUBFVDQZIQNVRCEZOUOYYZHNFKQWJPPLGSCTRSHAOKQWQIDCKRHMHFZXZYMEYPAVLOSJTKLGGSUXMCECJDDYGONEZQMWBBUDHRFRQRAIPSSQLXFPDEQRYVVYBRBQVQMSAUJBTNXTQSHTOYMZEUEZHRYDZWATDVXGAZAROGICLZXOEXOVRKMASOMZDPAKTAALGKCANNKCNJTSEIQMRMWVCMFPZSAWPZIHOCUYJDXWPNJVSJNQYHTPDYSHUHUQANSWQVQTZAJFVUDSVIMXFYZHTBIIYYSXFWGHJLOMCKHEIOWFTUUVGCJEZMKTVDLMOWMUHZAKWWKFCAGXMRSGEAEEZMPQKREXBVDZQXTXWMDCFQRWFZZVWXDMNREQTVTUWGQHNJIGUUAEQSLXMTUUJVQKHADYGMAVSQGWOUYGJDIDQTZVNGPYSHSLXPBWXDCPMILVQSIJNUCJWDPMHGAPISQDGJQWATMPLRIMFECIAYPZYHBZBODOXIUFTPFXHBAUVKJUQSUHTUTGSGVMVYLZQWBYHRVSVAIHTKNGWVSGZGMZCSZWZOSPADPERJVFMPAGRUBCNMGYJGJPYRHWZLORXFPHNEVYIYCMXDHWSPHNMSECSAEMPQBJVWOZIEESRVQJDJCHUKQXDZPWSSPLXVOUBCJJNETLNJBLKBSEHESKKAARZSUQDFYMFFRHUAAGBIUXOLQIDAAJJEUCZLGGGJUNMRPWLRUTPOQAXOYNSFTAAMYYNJNZIAYRQYPAMDJGXPLUWBUZOGNWKYQHGFBTJOTUMSHJCUGZOETKOPEHGSZHCKKJYJNFKKABODOWNAWDSQVWQUHGWIKROJNZUXRHUZUJSJTPGFGQUDYBXFXTOQNPTCPPJODVVFCLFOAXBKJCMMQZFVBARYEZNUSRFNWQMSOEWJAUIDBFHGBHPPCATPVUHVUREMMKNJVUDLUYTKFBUHUORYWURRCUBNURDESBTXIMJNSNZVAOHWNBQZUROVRVIXSEFEATFSDYHVZUPQSETAOMTHQVYEFDRWSLJHAREIUPEQKJKJQEJLDHZKCMRFVNVAFXDVRXZBFVJJREMEVVDJVOWHGMIUSVSCTQOCVCWWKGVLXHBBUBBHRBVBEYYDTOCHQEDKMUBWTWZGNQXZYNCSHGVZOXZGXXUYOPLGUYCOIKRPPPBAQWOAIRERJFKVNHGTDAWGPUCLSZUYSGVFZOGPYNFDVXOVTJLFZBMZOIPWTLMZMVLUBRKCJUOPNUIZWDFGBEKKUYFZYBXJTLTPKBKRSAASMOKXTYTLFWLVQZZZJYWLCCKXSPQVRILPPBPSJKEPPHXAGBQESHEHBARMBFIQNWZCLLBMYUDNZOGBOYEQGYVNGICQCUCORMKYDPPHKRQXDSWHFBKEHUKXTYJKXXSFTOXIFJCSMCFPLYINSXHLRHFAVAMFUKDNOYQMESTZSGXRESRBUJXBESVNGUNQHHAZUAMRDXTNLLTEUBUSPINULLEDCFKHOWMQIYIGXBXDEPBECSNILNMKPNZJIKUXYKTYEJOKRVULDNLGXFRBWTDMMFSUHOXIODDMRUDIZRKPTHQOHQHHACRQXLABFEVYCZVXIQQFRSQQXMUNKPDMNYKGXDKHOVFULQYETZUFKHVQQZKUDESBUMEWJTFQOMWDAZJINOUEZMHPQVMGYNCJDXCNUGBRGGYZVIBYQYBVFDXZAGDNCVANGLQOKBCYNKKPHYIBIGVYUMOYULQNMXOVXHGZZBOKDKSSRNXINKAOBPHKKRWREMMJEBKPQOKUJEQTRVMNRIRGEWCCNTESBBQDSYSVNOUKFUVOBOKJBRUAUANYBKFZGWFKVUTIYHCJQYPLMIVIIHRSRKNDFXGGHNEJENUUWNEFUOXPLSCQDODCIKFEYWQXPIGLWVRMTWTNYTLDTIWWTHGOMZZOWTCZJLFWNDEAVTMHCWOHLWBQYQCFSGKCKVUDMXLBAOGZRETGFEMOSDZIVYBDYVFVMBRHZPTCXLQEYKHIFRIEADJDYKSFNGIHJDNNSZTTQACTVKCBZROCHKSRMQUPWWDVGLTTZGSPTUIRUXSIUVISZUIUVXVEZYZCFWONKEYVMSFVMTNDEYVDSHZVZDRUFASHZVQABSBAZEUFGGBJTEXUQQFQEWDJEZIJDSLQBCACSNCKIAUAUJEVCVHHKWVGKVFYNWWBIUDOAILZVFLTGRJZPFMTWZVJFYYXJHCOJXAFOIYRVSAJQWVUUZWHWEKNMCCEDYMYFPROFNESDYIVZLKQAWBYKDVZFUVEBGWHBEHNVECKXOBMELQYBCQHFGNIISVEGGHAFITUHBRPYVSPSPPVIILVWIUUTQRUGZBMPJLYYZPUIVDIEEKICFJLZHOMVKIFJCOYKWQJGOHPVJEAODUFTNBNHBYYPRYQGOQWGBAFOXDZHBPBOMCVTBTBGDOFDVTDQFFAWRZAXZMRZNSYBMLAHRZACJXCUGOYVIDKLFOMPQSPRXAWKDOLMLTZTDNJMJKABXSULDRHLZMGBYMDNMNJMLDLDRLISLAXYMPOYXIWYYDDWQGETVSQIYQWMHAOJDXXMKCAFVDHUKAWFNXHHYZYBEEGPEVRHTNGFGUTJTHHTDNULZTFXBNRNYVICHURRRQNZQNQPLQEFHTXFZYCOEZUIRQPJLNGOGKFOWLAWHRAFEIBKPVOAODLPYAXDHKIKXBIPEHALJGENQYXZVHSZGGGCUKMMZKRVSTDRJZYUCFBJMZYJEFDJJAUSJZHTAKTQPOPXIFCOBLQHKOQCFFOXORXATWGEXICPUVGDSKEGNPWTMSCVOYIJQRHIOBHBKCUFZDGHRKXAHLEZWOYDMXZALWRUVJJAFKPNSDSRWAWBSUXQEUMAKMUZXHCRUJSPPHGRHDPKENFQZLQETMLAYZUAQPUWCBTQNDMSNCUXPRAFXZHRCJUWSMIRXIRFKWECNKGGSKOTATTYDTQPZUQLVEVPMEHKIBAIYCTBNIZUVRUMLGXVENUHJDUBHZDYXJFUZWEEOGDFDGUEVOTBMNLSTBIJQICEOVRKDUFLRHDMRHPYWZNYVDNCZPENXCNVDQXVWVYQIKAYGRWHUJMFQOTOJKSIZJRUATJIBZJSJCTMSEXVLBYSTSCAIBLSGOKJRDLCZJWIKNSHCIXPXXQDQHEEKVCKTAUGGGFYACKGOQBYHDKKPMBQTHVLDOOFMFEOIOPCKPTBCKIOZUCFYXHISVIJVYZLMQUGGSCXWOJYCICSYHORZPFUPRUOBCXTVGAGTCYVVNBZNRAGQQDUVQLNBONIHVLZOWYTOPSOCYNWBYVIRHLSJGVHQQTUPLOKBUJKANKIZJUQXFCNQTUEXVOZNQSLXNDJTMZCYEQWJMUYLFCIKGYTHOCBXFYKGSZODFWLRKCJICLEJKMWXTEZVRTFGGQJRCHDIAASUKCGCMRQKIWOEHVZSFXMJSHWUWHGIKMTBMORGMBKZAKVYDFXRGHINFVRMBQVKMEJPOVEFSDRKIHENVMZWSEENBKZMYALZPXRUXKHJQQCBONPKZFCUWQRPPLBWPGQZSPDVTBNMSVQENCSKNSGIUGPWYZWMUJBNEJCAUECNBVNVOMRALUKYWYJZWGIFGQHAZGJRFTAXDZZDTEFXVBDVMYCUTVSPHHYAMTVLCZHGPRHNRRFFRWZYIUDWWVSQKPJHICMYNBJDTKPWDVEYHLSBYQRAKAKITOOMLGFOJFSTWOBPMTUTMMMAINORPXWGZOUPRTAXJISZVIOJAQTVXNLMKPBMEOIDQFQFZZCAUIDWNIWAFZWZWADFGVUTPRYLVFAGSZTTJJTEYJRFXHQJNEQWQIWMVOZYVSHASONSOQSEZEZJYIYQBVUNJQVAWNSWNLOVVPFVOGUMEJPOLCHZLEECOSXDRWWARBOWRRXSJORRACKWJSXNVORNUMEECHKUSKUIZEGNFRHUVVFEEMKHHYSHHTPPBIXOASCMBXVTRH"
    # ss = "KKJZVYTGPKOWTQZLKLLAWNITVXKJZVYTGPKOWTQZLKLLAWNITVXK"
    ss = "ABA"
    # ss = "AAA"
    start_time = time.time()
    print(Solution().uniqueLetterString(ss))
    end_time = time.time()
    print("time:", end_time - start_time)
